<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Drop History</title>
    <link href="assets/css/history.css" rel="stylesheet"/>
  </head>
  <body>
    <div class="main-frame">
        <div class="selection">
            <div class="picker-button">
                <div class="icon"></div>
            </div>
            <div class="select-box" id="select">
                <div class="icon">
                    <div class="icon-img"></div>
                </div>
                <div class="name">CSS Hex</div>
                <div class="arrows">
                    <img src="./assets/img/arrows.png">
                </div>
            </div>
            <div class="titlebar">

            </div>
            <div class="window-options">
                &times;
            </div>
        </div>
        <div class="title">Color History</div>
        <div class="history">
            <ul id="history-list">
            </ul>
        </div>
        <div class="footer">

        </div>
    </div>
    <script>
        // You can also require other files to run in this process
        const {ipcRenderer, remote} = require('electron');

        ipcRenderer.on("get-history-response", function(event, color_history) {
            let elHistoryList = document.getElementById("history-list");
            for(let i=0;i<color_history.length;i++){
                const color = color_history[i];
                let elColorHistory = document.createElement("li");
                elColorHistory.setAttribute("style","background: #"+color+";");
                elColorHistory.addEventListener("click", function(e){
                    ipcRenderer.send("clicked", color);
                    elHistoryList.removeChild(elColorHistory);
                });
                elHistoryList.childNodes[0].after(elColorHistory);
            }
        })

        ipcRenderer.send("get-history");

        let colorTypesWindow = new remote.BrowserWindow({
            parent: remote.getCurrentWindow(),
            show: false,
            resizable: false,
            frame: false,
            transparent: true,
            alwaysOnTop: true,
            webPreferences: {
                nodeIntegration: true
            }
        });

        colorTypesWindow.loadURL('file://' + __dirname + '/color_types.html');

        colorTypesWindow.on('blur', () => {
            colorTypesWindow.hide();
        });

        ipcRenderer.on("color_history", function(event, color){
            let elHistoryList = document.getElementById("history-list");
            let elColorHistory = document.createElement("li");
            elColorHistory.setAttribute("style","background: "+color+";");
            elColorHistory.addEventListener("click", function(e){
                ipcRenderer.send("clicked", color.replace("#",""));
                elHistoryList.removeChild(elColorHistory);
            });
            elHistoryList.childNodes[0].after(elColorHistory);
        });

        ipcRenderer.on("color-type-change", (e, arg) => {
            document.querySelector("#select .name").innerHTML = arg.name;
            document.querySelector("#select .icon").className = "icon "+arg.icon
        });

        document.querySelector(".picker-button").addEventListener("click", function() {
            ipcRenderer.send("show-loop");
        })

        document.querySelector(".window-options").addEventListener("click", function(){
            var window = remote.getCurrentWindow();
            window.hide();
        })

        document.getElementById("select").addEventListener("click", function(e){
            if(!colorTypesWindow.isVisible()){
                let windowBounds = remote.getCurrentWindow().getBounds()

                let windowY = windowBounds.y + 60;
                let windowScreen = remote.screen.getDisplayNearestPoint({
                    x: windowBounds.x,
                    y: windowBounds.y
                })
                if(windowY + 260 >= windowScreen.bounds.height){
                    windowY = windowY - 260 - 45;
                }

                colorTypesWindow.setBounds({
                    width: 340,
                    height: 260,
                    x: windowBounds.x,
                    y: windowY
                },false);
                colorTypesWindow.show();
            }
            else{
                colorTypesWindow.hide();
            }
        });
    </script>
  </body>
</html>
