language: node_js
node_js: "13.8.0"
os:
  - linux
  - windows

addons:
  chrome: stable
  apt:
    packages:
      - xvfb

services:
  - xvfb

before_script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then export DISPLAY=:99.0; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sleep 3; fi

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get -y install libxtst-dev libpng++-dev; fi

install:
  - npm install robotjs --target=7.1.12
  - npm install
  - echo "npm test temporarily disabled"

script: true

jobs:
  include:
    - stage: test
      if: os = linux
      name: "Linting Checks"
      script: npm run lint
    - stage: test
      if: os = linux
      script: npm run test
      name: "Running E2E Tests"
    - stage: test
      if: os = windows
      script: true
      name: "Skipping Tests On Windows"
    - stage: build
      os: linux
      name: "Building Linux"
      script: npm run build
    - stage: build
      os: windows
      name: "Building Windows"
      script: npm run build
    - stage: deploy
      if: ((branch = master) OR (type = pull_request))
      os: windows
      name: "Deploying Windows Release"
      script: npm run release
    - stage: deploy
      os: linux
      if: ((branch = master) OR (type = pull_request))
      name: "Deploying Linux Release"
      script: npm run release
